(function(){!function(t){function o(t){return t.top<0||l?"absolute":"fixed"}function e(){return document.compatMode&&"css1compat"==document.compatMode.toLowerCase()?document.documentElement:document.body}function n(){var t=e();return{width:Math.max(t.clientWidth,t.scrollWidth),height:Math.max(t.clientHeight,t.scrollHeight)}}function i(t,o,e){var n,i=document.compatMode&&"css1compat"==document.compatMode.toLowerCase()?window.top===window.self?document.documentElement:top.document.documentElement:window.top===window.self?document.body:top.document.body;n=window.top===window.self?(i.clientHeight-t.outerHeight())*o+Math.max(document.documentElement.scrollTop,document.body.scrollTop):(i.clientHeight-t.outerHeight())*o+Math.max(top.document.documentElement.scrollTop,top.document.body.scrollTop),l||(n=(i.clientHeight-t.outerHeight())*o);var r=t.outerHeight(),d=Math.max(document.documentElement.clientHeight,document.body.clientHeight),c=n+r;c>d&&(n=(d-r)*o);var e=Math.floor(t.outerWidth()*e);return{marginLeft:-e,top:n}}function r(t){return t}function d(t){return"xbox"+t}function c(o){if("string"==typeof o)return g[o];if(o&&o.isqbox)return o;o=jQuery.event.fix(o||window.event);var e=t(o.target).parents(".qbox_content");return e.size()>0?g[d(e.data("ind"))]:void 0}function a(t,e,n){var r=i(t,e,n);t.css("position",o(r)),r.top<0&&(r.top=Math.max(top.document.documentElement.scrollTop,top.document.body.scrollTop)+10),t.css(r)}var s={top:.282,left:.5,fixable:!0,modeless:!1},l=function(){var t=!!window.ActiveXObject;return t&&!window.XMLHttpRequest}(),u={display:"none",position:"fixed",zIndex:1e4,top:"0px",left:"50%"},h={display:"none",position:"fixed",zIndex:1e4,top:"0px",left:"0px",opacity:.2,backgroundColor:"#000",height:"100%",width:"100%",margin:"0px",padding:"0px"},x=0,f=1e4,g={},p=function(o,e,n){this.key=d(n),this.args=e,this.alive=!0,this.binded=!1,this.overlay=t("<div />").addClass("qbox_overlay").css(t.extend({},h,{zIndex:f+n})).appendTo(t(document.body));var i=this.content=t("<div />").addClass("qbox_content").css(t.extend({},u,{zIndex:f+n})).appendTo(t(document.body));l&&(i.css("position","absolute"),this.overlay.css("position","absolute")),i.data("ind",n),"string"==typeof o?i.html(r(o)):i.append(t(o).show()),g[this.key]=this};p.prototype={isqbox:1},t.each(["close","show","hide","trigger","bind","unbind","data"],function(o,e){p.prototype[e]=function(){return t.xbox[e].apply(window,[this].concat(Array.prototype.slice.call(arguments||[])))}}),t.xbox=function(o,e){var n=++x;return e=t.extend(s,e||{}),new p(o||"",e,n)},t.xbox.bind=function(o,e,n){var i=c(o);i&&i.alive&&t(i.content).bind(e+".xbox."+i.key,n)},t.xbox.unbind=function(o,e,n){var i=c(o);i&&i.alive&&(n?t(i.content).unbind((e||"")+".xbox."+i.key,n):t(i.content).unbind((e||"")+".xbox."+i.key))},t.xbox.trigger=function(o,e,n){var i=c(o);i&&i.alive&&t(i.content).triggerHandler(e+".xbox."+i.key,n)},t.xbox.data=function(t,o,e){var n=c(t);if(n&&n.alive)return n.content.data(o,e)},t.xbox.show=function(o){var e=c(o);if(e&&e.alive){e.args.modeless||e.overlay.show(),e.content.show(),e.binded||(e.binded=!0,t(window).bind("resize.xbox",function(){e.args.fixable&&a(e.content,e.args.top,e.args.left),e.overlay.css(n(!0)),t(e.content).trigger("changePosition",e.content)}),t(window).bind("scroll.xbox",function(){e.args.fixable&&l&&a(e.content,e.args.top,e.args.left),t(e.content).trigger("changePosition",e.content)})),e.args.fixable&&a(e.content,e.args.top,e.args.left);var i=e.args.fixable;e.args.fixable=!0,t(window).triggerHandler("resize.xbox"),e.args.fixable=i,t(e.content).trigger("changePosition",e.content),t(e.content).trigger("show",e.content)}},t.xbox.hide=function(o){var e=c(o);e&&e.alive&&(t(window).unbind("scroll.xbox"),t(window).unbind("resize.xbox"),e.binded=!1,e.overlay.hide(),e.content.hide(),t(e.content).triggerHandler("hide.xbox."+e.key))},t.xbox.close=function(o){var e=c(o);e&&e.alive&&(t.xbox.hide(e),e.alive=e.binded=!1,e.overlay.remove(),e.content.remove(),delete g[e.key],t(e.content).triggerHandler("close.xbox."+e.key))}}(jQuery),Class.define("Dialog",{extend:plugin.Base,initialize:function(){this.dialog=$.xbox(this.getHtml()),this.parent(this.dialog.content),this.$root.bgiframe()},init:function(){this.show()},show:function(){this.dialog.show(),this.isHideOverlay&&this.dialog.overlay.hide()},hideOverlay:function(){this.isHideOverlay=!0;var t="mousedown.xbox."+this.dialog.key,o=this;$(document).unbind(t).bind(t,function(t){$.contains(o.$root[0],t.target)||o.hide()})},setPosition:function(t,o,e){this.$root.css("position","absolute");var n={width:$(t).outerWidth(),height:$(t).outerHeight()+10},i=this;e=e||{},$(this.$root).unbind("changePosition").bind("changePosition",function(){var r=$(t).offset(),d={L:function(){return{left:r.left-i.$root.outerWidth()+n.width+(e.left||0)}},B:function(){return{top:r.top+n.height+(e.top||0)}},T:function(){return{top:r.top-i.$root.outerHeight()+(e.top||0)}},R:function(){return{left:r.left+(e.left||0)}}},c={marginLeft:0};$.each(o.split(""),function(t,o){var e=d[o.toUpperCase()];e&&$.extend(c,e())}),i.$root.css(c),i.$root.css("position","absolute")})},close:function(){this.dialog.close()},hide:function(){this.dialog.hide()},getHtml:function(){return"<div style='background-color: #ffffff; height: 100px; width: 300px;'>我是弹层</div>"}})}).call(this);